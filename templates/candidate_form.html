{% extends "base.html" %}
{% block content %}

<div class="row justify-content-center">
    <div class="col-lg-10">

        <div class="card shadow p-4">
            <h3 class="text-center mb-4">Candidate Application Form</h3>

            <form method="POST" enctype="multipart/form-data">

                <!-- ================== BASIC DETAILS ================== -->
                <h5 class="mb-3">Basic Information</h5>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label>Full Name</label>
                        <input type="text" name="name" class="form-control" required>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label>Contact Number</label>
                        <input type="text" name="contact" class="form-control" minlength="10" maxlength="10" required>
                    </div>

                    <div class="col-md-12 mb-3">
                        <label>Email (Optional)</label>
                        <input type="email" name="email" class="form-control">
                    </div>

                    <div class="col-md-12 mb-3">
                        <label>Address</label>
                        <textarea name="address" class="form-control" rows="2" required></textarea>
                    </div>
                </div>

                <hr>

                <!-- ================== JOB DETAILS ================== -->
                <h5 class="mb-3">Job Details</h5>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label>Position Applied</label>
                        <input type="text" name="positionApplied" class="form-control">
                    </div>

                    <div class="col-md-6 mb-3">
                        <label>Area of Interest</label>
                        <input type="text" name="areaOfInterest" class="form-control">
                    </div>

                    <div class="col-md-4 mb-3">
                        <label>Current Salary</label>
                        <input type="text" name="currentSalary" class="form-control">
                    </div>

                    <div class="col-md-4 mb-3">
                        <label>Expected Salary</label>
                        <input type="text" name="expectedSalary" class="form-control">
                    </div>

                    <div class="col-md-4 mb-3">
                        <label>Notice Period</label>
                        <input type="text" name="noticePeriod" class="form-control">
                    </div>
                </div>

                <hr>

                <!-- ================== ACADEMIC DETAILS ================== -->
                <h5 class="mb-3">Academic Details</h5>

                <input type="hidden" id="academic_json" name="academic_json">

                <table class="table table-bordered" id="academic_table">
                    <thead class="table-light">
                        <tr>
                            <th>Sr</th>
                            <th>Qualification</th>
                            <th>College / University</th>
                            <th>Year</th>
                            <th>Grade</th>
                            <th width="70">Action</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>

                <button type="button" class="btn btn-secondary mb-3" onclick="addAcademic()">+ Add Academic Row</button>

                <hr>

                <!-- ================== PROFESSIONAL DETAILS ================== -->
                <h5 class="mb-3">Professional Experience</h5>

                <input type="hidden" id="professional_json" name="professional_json">

                <table class="table table-bordered" id="professional_table">
                    <thead class="table-light">
                        <tr>
                            <th>Sr</th>
                            <th>Company</th>
                            <th>Designation</th>
                            <th>Tenure</th>
                            <th>Reason for Leaving</th>
                            <th width="70">Action</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>

                <button type="button" class="btn btn-secondary mb-3" onclick="addProfessional()">+ Add Experience Row</button>

                <hr>

                <!-- ================== FAMILY DETAILS ================== -->
                <h5 class="mb-3">Family Details</h5>

                <input type="hidden" id="family_json" name="family_json">

                <table class="table table-bordered" id="family_table">
                    <thead class="table-light">
                        <tr>
                            <th>Sr</th>
                            <th>Name</th>
                            <th>Relation</th>
                            <th>Age</th>
                            <th>Occupation</th>
                            <th width="70">Action</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>

                <button type="button" class="btn btn-secondary mb-3" onclick="addFamily()">+ Add Family Row</button>

                <hr>

                <!-- ================== OTHER DETAILS ================== -->
                <h5 class="mb-3">Reference & Other Details</h5>

                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label>Reference Type</label>
                        <select name="referenceType" class="form-control">
                            <option value="">Select</option>
                            <option>Internal</option>
                            <option>External</option>
                        </select>
                    </div>

                    <div class="col-md-8 mb-3">
                        <label>Reference Name</label>
                        <input type="text" name="referenceName" class="form-control">
                    </div>

                    <div class="col-md-12 mb-3">
                        <label>Other Details</label>
                        <textarea name="otherDetails" class="form-control" rows="2"></textarea>
                    </div>

                    <div class="col-md-12 mb-3">
                        <label>Upload Resume (PDF/DOC/DOCX)</label>
                        <input type="file" name="resume" class="form-control">
                    </div>
                </div>

                <button class="btn btn-primary w-100 mt-3">Submit Application</button>

            </form>

        </div>
    </div>
</div>

<!-- ================== DYNAMIC TABLE SCRIPTS ================== -->
<script>
    function addAcademic() {
        let table = document.querySelector("#academic_table tbody");
        let row = document.createElement("tr");

        row.innerHTML = `
            <td></td>
            <td><input class="form-control" /></td>
            <td><input class="form-control" /></td>
            <td><input class="form-control" /></td>
            <td><input class="form-control" /></td>
            <td><button type="button" class="btn btn-danger btn-sm" onclick="removeRow(this)">X</button></td>
        `;

        table.appendChild(row);
        updateSr();
    }

    function addProfessional() {
        let table = document.querySelector("#professional_table tbody");
        let row = document.createElement("tr");

        row.innerHTML = `
            <td></td>
            <td><input class="form-control" /></td>
            <td><input class="form-control" /></td>
            <td><input class="form-control" /></td>
            <td><input class="form-control" /></td>
            <td><button type="button" class="btn btn-danger btn-sm" onclick="removeRow(this)">X</button></td>
        `;

        table.appendChild(row);
        updateSr();
    }

    function addFamily() {
        let table = document.querySelector("#family_table tbody");
        let row = document.createElement("tr");

        row.innerHTML = `
            <td></td>
            <td><input class="form-control" /></td>
            <td><input class="form-control" /></td>
            <td><input class="form-control" /></td>
            <td><input class="form-control" /></td>
            <td><button type="button" class="btn btn-danger btn-sm" onclick="removeRow(this)">X</button></td>
        `;

        table.appendChild(row);
        updateSr();
    }

    function removeRow(btn) {
        btn.parentElement.parentElement.remove();
        updateSr();
    }

    function updateSr() {
        document.querySelectorAll("#academic_table tbody tr").forEach((r, i) => r.children[0].innerText = i + 1);
        document.querySelectorAll("#professional_table tbody tr").forEach((r, i) => r.children[0].innerText = i + 1);
        document.querySelectorAll("#family_table tbody tr").forEach((r, i) => r.children[0].innerText = i + 1);
    }

    document.querySelector("form").addEventListener("submit", function () {
        document.getElementById("academic_json").value = JSON.stringify(
            [...document.querySelectorAll("#academic_table tbody tr")].map(r => ({
                sr: r.children[0].innerText,
                qualification: r.children[1].children[0].value,
                college: r.children[2].children[0].value,
                year: r.children[3].children[0].value,
                grade: r.children[4].children[0].value,
            }))
        );

        document.getElementById("professional_json").value = JSON.stringify(
            [...document.querySelectorAll("#professional_table tbody tr")].map(r => ({
                sr: r.children[0].innerText,
                company: r.children[1].children[0].value,
                designation: r.children[2].children[0].value,
                tenure: r.children[3].children[0].value,
                reason: r.children[4].children[0].value,
            }))
        );

        document.getElementById("family_json").value = JSON.stringify(
            [...document.querySelectorAll("#family_table tbody tr")].map(r => ({
                sr: r.children[0].innerText,
                name: r.children[1].children[0].value,
                relation: r.children[2].children[0].value,
                age: r.children[3].children[0].value,
                occupation: r.children[4].children[0].value,
            }))
        );
    });
</script>

{% endblock %}
